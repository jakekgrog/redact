<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../assets/css/main.css">
    <title>Redact</title>
</head>
<body>
    <div id="images"></div>
    <canvas style="margin:auto;padding:0;position:relative;display:block;" id="imgCanvas" width="0" height="0" onclick="draw(event)"></canvas>
    
    <input type="file" id="upload-file" name="Upload Image" value="Upload Image">

    <script type="text/javascript" charset="utf-8">

        
                
        var canvas = document.getElementById("imgCanvas");
        var context = canvas.getContext("2d");

        let img = new Image();
        let filename = '';
        let drawing = false;
        let startx = 0;
        let starty = 0;
        let endx = 0;
        let endy = 0;

        const uploadFile = document.getElementById('upload-file');

        uploadFile.addEventListener('change', e => {
            const file = document.getElementById('upload-file').files[0];

            const reader = new FileReader();

            if(file){
                filename = file.name;
                reader.readAsDataURL(file);
            }

            reader.addEventListener('load', () => {
                img = new Image();
                img.src = reader.result;
                img.onload = function() {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    context.drawImage(img, 0, 0, canvas.width, canvas.height);
                }
                uploadFile.style.display = "none";
            }, false);
        });

        function createImageOnCanvas(imageId) {
            canvas.style.display = "block";
            document.getElementById("images").style.overflowY = "hidden";
            var img = new Image(300, 300);
            img.src = document.getElementById(imageId).src;
            context.drawImage(img, (0), (0)); //onload....
        }
        
        function draw(e) {
            if(drawing == false){
                var pos = getMousePos(canvas, e);
                startx = pos.x;
                starty = pos.y;
                drawing = true;
            } else {
                var posend = getMousePos(canvas, e);
                endx = posend.x;
                endy = posend.y;
                context.fillStyle = "#0000000";
                context.beginPath();
                context.moveTo(startx, starty);
                context.lineTo(endx, endy);
                context.lineWidth = 15;
                context.stroke();
                drawing = false;
            }
            
        }

        function getMousePos(canvas, evt) {
            var rect = canvas.getBoundingClientRect();
            return {
            x: evt.clientX - rect.left,
            y: evt.clientY - rect.top
            };
        }

        window.draw = draw;
    </script>
</body>
</html>